<!DOCTYPE html>
<html>
<head>
  <style>
    #vis.vega-embed {
      width: 100%;
      display: flex;
    }

    #vis.vega-embed details,
    #vis.vega-embed details summary {
      position: relative;
    }
    input[type="range"] {
            display: none;
    
    }
  </style>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.20.1"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <div id="vis"></div>
  <div id="threshold-display">Threshold: 5</div>
  <script>
    (function(vegaEmbed) {
      var spec = {
        "config": 
          {
            "view": 
              {
                "continuousWidth": 400, 
                "continuousHeight": 400
              }
          }, 
        "layer": 
          [
            {
              "data": 
                {
                  "url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/movies.json"
                }, 
              "mark": 
                {
                  "type": "circle"
                }, 
              "encoding": 
                {
                  "x": 
                    {
                      "field": "IMDB_Rating", "title": "IMDB Rating", "type": "quantitative"
                    },
                  "y": 
                    {
                      "field": "Rotten_Tomatoes_Rating", "title": "Rotten Tomatoes Rating", "type": "quantitative"
                    }
                }, 
              "transform": 
                [
                  {
                    "filter": "(datum['IMDB_Rating'] >= threshold)"
                  }
                ]
            }, 
            {
              "data": 
              {
                "url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/movies.json"
              }, 
              "mark": 
              {
                "type": "circle"
              }, 
              "encoding": 
              {
                "size": 
                {
                  "aggregate": "count", "scale": {"domain": [0, 160]}, "type": "quantitative"
                }, 
                "x": 
                {
                  "bin": {"maxbins": 10}, 
                  "field": "IMDB_Rating", 
                  "type": "quantitative"
                }, 
                "y": 
                {
                  "bin": {"maxbins": 10}, 
                  "field": "Rotten_Tomatoes_Rating", 
                  "type": "quantitative"
                }
              }, 
              "transform": [{"filter": "(datum['IMDB_Rating'] < threshold)"}]
            }, 
            {
              "data": {"name": "empty"}, 
              "mark": {"type": "rule", "color": "gray"}, 
              "encoding": {"strokeWidth": {"value": 6}, 
              "x": {"type": "quantitative", "datum": {"expr": "threshold"}}}
            }
          ], 
          "params": [{"name": "threshold", "bind": {"input": "range", "max": 10, "min": 0, "step": 0.1}, "value": 5}], 
          "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"empty": [{}]}};
      var embedOpt = {"mode": "vega-lite"};

      function showError(el, error){
          el.innerHTML = ('<div style="color:red;">'
                          + '<p>JavaScript Error: ' + error.message + '</p>'
                          + "<p>This usually means there's a typo in your chart specification. "
                          + "See the javascript console for the full traceback.</p>"
                          + '</div>');
          throw error;
      }
      const el = document.getElementById('vis');
      vegaEmbed("#vis", spec, embedOpt).then(({view}) => {
            let threshold = view.signal('threshold');

            function updateThreshold(value) {
                threshold = Math.max(0, Math.min(10, threshold + value));
                view.signal('threshold', threshold).run();
                document.getElementById('threshold-display').innerText = `Threshold: ${threshold.toFixed(1)}`;
            }

            function handleGamepadInput() {
                const gamepads = navigator.getGamepads();
                if (gamepads[0]) {
                    const gp = gamepads[0];
                    const axisValue = gp.axes[0]; // Assuming the left joystick's horizontal axis
                    const aPressed = gp.buttons[0].pressed;    // A button
                    if (axisValue > 0.1) { // Deadzone threshold prevents stick drift
                        updateThreshold(axisValue **4 *0.1); 
                    } else if (axisValue < -0.1) {
                        updateThreshold(-1 * axisValue **4 *0.1); 
                    }
                    // Threshold adjustment using the A button
                    if (aPressed) {
                        if (threshold - Math.floor(threshold) < 0.5) {
                            threshold = Math.floor(threshold);
                            view.signal('threshold', threshold).run();
                            document.getElementById('threshold-display').innerText = `Threshold: ${threshold.toFixed(1)}`;
                        } else {
                            threshold = Math.ceil(threshold);
                            view.signal('threshold', threshold).run();
                            document.getElementById('threshold-display').innerText = `Threshold: ${threshold.toFixed(1)}`;
                        }
                    }
                }
                requestAnimationFrame(handleGamepadInput);
            }

            window.addEventListener("gamepadconnected", () => {
                console.log("Gamepad connected");
                handleGamepadInput();
            });

            window.addEventListener("gamepaddisconnected", () => {
                console.log("Gamepad disconnected");
            });
        });
    })(vegaEmbed);

    

  </script>
</body>
</html>